{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-md-5">
    {% if movie.image_url %}
      <img src="{{ movie.image_url }}" class="img-fluid rounded mb-3" alt="{{ movie.name }}">
    {% endif %}
    <a href="{{ movie.url }}" target="_blank" class="btn btn-outline-secondary w-100">Ver enlace</a>
  </div>
  <div class="col-md-7">
    <h2>{{ movie.name }}</h2>
    <p>{{ movie.description }}</p>

    <hr>
    <h4>Rese침as</h4>

    {% if user.is_authenticated %}
    <form action="{% url 'review_create' movie.id %}" method="post" class="mb-4">
      {% csrf_token %}
      {{ form.as_p }}
      <button class="btn btn-success" type="submit">Publicar rese침a</button>
    </form>
    {% else %}
      <p><a href="{% url 'login' %}?next={{ request.path }}">Inicia sesi칩n</a> para escribir una rese침a.</p>
    {% endif %}

    {% for r in reviews %}
      <div class="border rounded p-3 mb-3">
        <div class="d-flex justify-content-between">
          <strong>{{ r.user.username }}</strong>
          <small class="text-muted">{{ r.created_at|date:"Y-m-d H:i" }}</small>
        </div>
        <p class="mb-1">{{ r.content }}</p>
        <div class="small">{{ r.watch_again|yesno:"游 Ver칤a de nuevo,No ver칤a de nuevo" }}</div>
        {% if user.is_authenticated and r.user_id == user.id %}
          <div class="mt-2">
            <a href="{% url 'review_edit' r.pk %}" class="btn btn-sm btn-outline-primary">Editar</a>
            <a href="{% url 'review_delete' r.pk %}" class="btn btn-sm btn-outline-danger">Eliminar</a>
          </div>
        {% endif %}
      </div>
    {% empty %}
      <p>No hay rese침as todav칤a.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
